Часть 2. Микроконтроллеры семейства Mega 
ложенного по адресу $0Е ($2Е). Разряды с 7-го по 1-й этого регистра  
доступны только для чтения, а 0-й разряд — как для чтения, так и для записи. 
Формат этого регистра приведен на Рис. 2.106, а назначение его разрядов 
описано в Табл. 2.135. 
Рис. 2.106. Формат регистра SPSR 
Таблица 2.135 Разряды регистра SPSR 
Разряд 
7 
6 
5...1 
0 
Название 
SPIF 
WCOL 
- 
SPI2X 
Описание 
Флаг прерывания от SPI. Данный флаг устанавливается в «1» по  
окончании передачи очередного байта. Если флаг SPIE регистра SPCR установлен 
в «1» и прерывания разрешены, одновременно с установкой флага  
генерируется прерывание от SPI. Также флаг SPIF устанавливается в «1» при переводе 
микроконтроллера из режима «Master» в режим «Slave» посредством вывода 
S5 (см. 17.3). Флаг сбрасывается аппаратно, либо при старте подпрограммы 
обработки прерывания, либо после чтения регистра состояния SPI с  
последующим обращением к регистру данных SPI (SPDR) 
Флаг конфликта записи. Данный флаг устанавливается в «1» при попытке 
записи в регистр данных (SPDR) во время передачи очередного байта. Флаг 
сбрасывается аппаратно после чтения регистра состояния SPI с  
последующим обращением к регистру данных SPI 
Зарезервированы, читаются как «0» 
Удвоение скорости обмена. При установке этого разряда в «1» и работе 
микроконтроллера в режиме «Master» частота сигнала SCK удваивается 
Передаваемые данные записываются, а принимаемые — считываются из 
регистра данных SPDR, расположенного по адресу $0F ($2F). Запись в этот 
регистр инициирует начало передачи, а при его чтении считывается  
содержимое буфера сдвигового регистра. Другими словами, регистр данных  
служит буфером между регистровым файлом микроконтроллера и сдвиговым 
регистром модуля SPI. 
Соединение двух микроконтроллеров (ведущий—ведомый) по  
интерфейсу SPI показано на Рис. 2.107. Вывод SCK ведущего микроконтроллера 
является выходом тактового сигнала, а ведомого микроконтроллера —  
входом. 
Перед выполнением обмена необходимо, прежде всего, разрешить  
работу модуля SPI. Для этого следует установить в «1» разряд SPE регистра 
SPCR. Режим работы определяется состоянием разряда MSTR этого 
регистра: если разряд установлен в «1», микроконтроллер работает в режиме 
«Master», если сброшен в «0» — в режиме «Slave». 
-350- 
