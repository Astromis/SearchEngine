Часть 2. Микроконтроллеры семейства Mega 
Таймеры/счетчики Т1 и ТЗ могут генерировать прерывание при  
наступлении следующих событий: 
• при переполнении счетного регистра; 
• при равенстве счетного регистра и регистра сравнения (по одному 
прерыванию на каждый блок сравнения); 
• при сохранении счетного регистра в регистре захвата. 
Флаги всех прерываний таймеров/счетчиков Т1 и ТЗ находятся в  
регистрах TIFR и ETIFR, а разрешение/запрещение этих прерываний  
осуществляется установкой/сбросом соответствующих флагов регистров TIMSK и 
ETIMSK(cm. подраздел 13.3). 
Счетный регистр таймера/счетчика TCNT1 C) входит в состав  
основного блока модуля — блока реверсивного счетчика. В зависимости от режима 
работы модуля содержимое счетного регистра сбрасывается, инкрементиру- 
ется или декрементируется по каждому импульсу тактового сигнала  
таймера/счетчика clkTi (clkT3). Независимо от того, присутствует тактовый сигнал 
или нет, регистр доступен в любой момент времени как для чтения, так и 
для записи. При этом любая операция записи в счетный регистр 
блокирует работу всех блоков сравнения на время одного периода 
тактового сигнала таймера/счетчика. После подачи напряжения питания 
в регистре TCNT1 C) находится нулевое значение. При некоторых  
изменениях состояния таймера/счетчика, определяемых режимом его 
работы, устанавливается флаг TOV1 C) регистра TIFR. Разрешение  
прерывания осуществляется установкой в «1» разряда TOIE1 C) регистра TIMSK. 
Регистры OCR1A/OCR1B/OCR1C (OCR3A/OCR3B/OCR3C) входят в 
состав блоков сравнения. Во время работы таймера/счетчика производится 
непрерывное (в каждом машинном цикле) сравнение этих регистров с  
регистром TCNT1 (TCNT3). В случае равенства содержимого регистра  
сравнения и счетного регистра в следующем машинном цикле устанавливается  
соответствующий флаг OCF1A/OCF1B/OCF1C (OCF3A/OCF3B/OCF3C) 
регистра TIFR и генерируется прерывание (если оно разрешено). Также при 
наступлении этого события может изменяться состояние вывода 
ОС1А/ОС1В/ОС1С (ОСЗА/ОСЗВ/ОСЗС) микроконтроллера. Чтобы  
таймер/счетчик мог управлять состоянием какого-либо из этих выводов, он 
должен быть сконфигурирован как выходной (соответствующий разряд  
регистра DDRx должен быть установлен в «1»). 
Особенностью работы блока сравнения в режимах, предназначенных 
для формирования ШИМ-сигналов, является двойная буферизация записи 
в регистры сравнения. Она заключается в том, что записываемое число на 
самом деле сохраняется в специальном буферном регистре. А изменение  
содержимого регистра сравнения происходит только при достижении  
счетчиком максимального значения. 
Регистр захвата ICR1 (ICR3) входит в состав блока захвата, назначе- 
-282- 
