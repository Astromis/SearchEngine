Часть 2. Микроконтроллеры семейства Mega 
18.5.3. Режим «Ведомый приемник» 
В режиме «Ведомый приемник» ведомое устройство осуществляет прием 
данных от ведущего. Перед тем как переключить модуль в режим 
«Ведомый приемник», следует занести в старшие разряды регистра TWAR 
адрес устройства и в соответствии с логикой работы программы установить 
или сбросить младший разряд регистра (TWGCE). Затем необходимо 
записать в регистр TWCR следующее значение: 
Разрешить работу модуля TWI 
Разрешить подтверждение 
После инициализации регистров TWAR и TWCR модуль будет ожвдать 
адресного пакета с адресом, указанным в регистре TWAR, или общего  
вызова (если его распознавание разрешено). Значение следующего за адресом 
бита направления определит режим, в который переключится модуль. Если 
этот бит будет сброшен в «О» (запись), модуль TWI переключится в режим 
«Ведомый приемник». В противном случае модуль переключится в режим 
«Ведомый передатчик». Напоминаем еще раз, что устройство также может 
самостоятельно переключиться в режим «Ведомый приемник» из режима 
ведущего при потере приоритета (см. описание кодов статуса $68 и $78 
в Табл. 2.147). 
После приема пакета SLA+W установится флаг TWINT и состояние  
обмена по шине можно будет, как обычно, определить по коду статуса.  
Возможные действия со стороны программы, соответствующие тому или иному 
коду статуса, указаны в Табл. 2.147. 
Чтобы прервать поток данных, следит сбросить в «О» разряд TWEA  
регистра TWCR (это можно сделать и во время обмена, т. е. при сброшенном 
флаге TWINT). В результате после передачи следующего байта на линию 
SDA будет вьщан сигнал неподгверждения, сигнализирующий ведущему о 
том, что ведомый не может больше осуществлять прием данных. Обработка 
адресных пакетов при сброшенном разряде TWEA прекращается, но может 
быть возобновлена в любой момент времени повторной установкой этого 
разряда. 
Если адресация устройства произойдет при нахождении  
микроконтроллера в «спящем» режиме и разряд TWEA будет при этом установлен, модуль 
TWI переведет микроконтроллер в рабочий режим. 
-378- 
