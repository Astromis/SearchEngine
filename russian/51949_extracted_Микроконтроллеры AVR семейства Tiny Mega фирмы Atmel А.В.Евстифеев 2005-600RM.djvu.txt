Часть 2. Микроконтроллеры семейства Mega 
Следует иметь в ввду, что обработка описанных флагов в модулях UART 
и USART несколько отличается. В модулях UART флаг ошибки  
кадрирования FE (FEn) должен быть прочитан перед обращением к регистру данных, 
а флаг переполнения OR (ORn) — после обращения к этому регистру. 
В модулях USART все флаги ошибок буферизуются вместе со словом 
данных, т. е. соответствующие разряды регистра UCSRA (UCSR/iA)  
относятся к кадру, слово данных которого будет прочитано при следующем  
обращении к регистру данных UDR (UDR#). Поэтому состояние этих флагов 
должно быть считано перед обращением к регистру данных. Кроме того, для 
совместимости с будущими устройствами рекомендуется при записи в  
регистр UCSRA (UCSR/iA) сбрасывать соответствующие этим флагам  
разряды записываемого значения в «О». 
Для ивдикации состояния приемника в модулях USART/UART  
используется флаг прерывания «Прием завершен» RXC (RXOj) регистра UCSRA 
(UCSR/iA). Этот флаг устанавливается в «1» при наличии в буфере  
приемника непрочитанных данных. В модулях UART этот флаг сбрасывается  
после прочтения регистра данных, а в модулях USART — при опустошении  
буфера (после считывания всех находящихся в нем данных). 
Выключение приемника осуществляется сбросом разряда RXEN 
(RXENaj) регистра UCSRB (UCSR/iB). В отличие от передатчика приемник 
выключается сразу же после сброса разряда, т. е. кадр, принимаемый в этот 
момент, теряется. В модулях USART, кроме того, при выключении  
приемника очищается его буфер, т. е. теряются также все непрочитанные данные. 
При выключенном приемнике вывод RXD (RXDh) может использоваться 
как контакт ввода/вывода общего назначения. 
Пример подпрограммы приема по интерфейсу USART приведен ниже. 
Как и в предьщущем примере, здесь используется опрос флага прерывания. 
Пример на ассемблере 
USART_Receive: 
;Ждать загрузки данных в буфер приемника 
sbis UCSRA,RXC 
rjmp USART_Receive 
/Прочитать 9-й разряд данных и флаги состояния 
in rl8,UCSRA 
in rl7,UCSRB 
/Прочитать младший байт данных 
in rl6,UDR 
;В случае ошибки вернуть -1 
andi rl8, A«FE) I A«DOR) | A«UPE) 
breq no_error 
-342- 
