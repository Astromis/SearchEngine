Часть 1. Микроконтроллеры семейства Tiny 
Команда RCALL сохраняет в стеке значение счетчика команд.  
Затем содержимое счетчика команд увеличивается или уменьшается на 
некоторое значение, являющееся операндом команды (Рис. 1.23). 
В программах в качестве операндов этой команды, как и в случае 
команды RJMP, используются метки. Ассемблер сам вычисляет  
величину перехода и подставляет это значение в слово команды. 
Команда относительного вызова подпрограмм выполняется за 3 
машинных цикла, 2 из которых затрачиваются на сохранение в стеке 
двух байт счетчика команд. 
2.3.8. Команды возврата из подпрограмм 
В конце каждой подпрограммы обязательно должна находиться  
команда возврата из нее. В системе команд микроконтроллеров семейства 
имеется две таких команды. Для возврата из обычной подпрограммы, 
вызываемой командой RCALL, используется команда RET. Для возврата 
из подпрограммы обработки прерывания используется команда RETI. 
Обе команды восстанавливают из стека содержимое счетчика  
команд, сохраненное там перед переходом к подпрограмме. Команда 
возврата из подпрограммы RETI дополнительно устанавливает в «1» 
флаг общего разрешения прерываний I регистра SREG, сбрасываемый 
аппаратно при возникновении прерывания. 
На выполнение каждой из команд возврата из подпрограммы  
требуется 4 машинных цикла. 
2.4. Стек 
В микроконтроллерах AVR семейства Tiny стек реализован аппаратно. 
Глубина стека равна трем уровням, а размер равен размеру счетчика  
команд (9 или 10 разрядов). Стек расположен в собственной области памяти 
и имеет LIFO-организацию (Last In First Out — последним вошел, первым 
вышел), т. е. значение, записанное последним, будет прочитано первым. 
При вызове подпрограммы адрес команды, расположенной за  
командой RCALL, сохраняется в стеке. При возврате из подпрограммы этот  
адрес извлекается из стека и загружается в счетчик команд. Тоже  
происходит и во время прерывания. При генерации прерывания адрес следующей 
команды сохраняется в стеке, а при возврате из подпрограммы обработки 
прерывания он восстанавливается из стека. 
Непосредственно из программы стек недоступен, т. к. в наборе  
команд микроконтроллера отсутствуют команды занесения в стек и  
извлечения из стека. Указатель стека также недоступен из программы, т. е. он 
не может быть явно прочитан или модифицирован. Поэтому микрокон- 
-46- 
