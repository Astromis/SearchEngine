Часть 2. Микроконтроллеры семейства Mega 
Еще раз напоминаем, что любое устройство, подключенное к шине TWI, 
может увеличивать длительность паузы между тактовыми импульсами, 
снижая, таким образом, скорость передачи данных по шине. 
Блок шинного интерфейса (Bus Interface Unit) 
В состав этого блока входят два узла: 
• контроллер состояний СТАРТ/СТОП формирует и обнаруживает 
состояния СТАРТ, ПОВСТАРТ и СТОП. Мониторинг состояния 
шины ведется даже при нахождении микроконтроллера в  
«спящем» режиме. Благодаря этому обеспечивается при  
необходимости выход микроконтроллера из «спящего» режима при  
адресации его каким-либо ведущим; 
• контроллер арбитража определяет наличие конфликтов на шине 
при работе микроконтроллера в режиме ведущего. В случае  
потери устройством приоритета контроллер информирует об этом 
блок управления, который производит необходимые действия и 
формирует соответствующие коды состояния. 
Кроме того, в состав блока входит сдвиговый регистр адреса/данных 
TWDR, который содержит данные передаваемого или принимаемого  
пакета. Одновременно с выдвиганием содержимого регистра на шину данные с 
нее вдвигаются в этот регистр. Таким образом, почти всегда, за  
исключением момента выхода микроконтроллера из «спящего» режима, в регистре 
TWDR содержится последний байт, имевшийся на шине. При включении 
питания все разряды этого регистра устанавливаются в «1». При этом  
инициализация регистра пользователем может быть осуществлена только после 
генерации первого прерывания. 
Помимо регистра TWDR в составе блока имеется специальный регистр, 
один из разрядов которого содержит значение переданного или принятого 
бита подтверждения. При приеме состояние этого бита задается одним из 
разрядов регистра управления TWCR, а при передаче состояние  
полученного бита подтверждения может быть определено по коду, находящемся в  
регистре состояния TWSR. 
Блок контроля адреса (Address Match Unit) 
Блок контроля адреса проверяет принятый адрес на соответствие  
значению, находящемуся в старших семи разрядах регистра адреса TWAR. Также 
он проверяет наличие общих вызовов, если разрешено их распознавание. 
При обнаружении корректного адреса он информирует об этом блок  
управления, который формирует или не формирует подтверждение получения  
адресного пакета. Контроль адресных пакетов осуществляется блоком даже 
при нахождении микроконтроллера в «спящем» режиме, что позволяет 
-364- 
