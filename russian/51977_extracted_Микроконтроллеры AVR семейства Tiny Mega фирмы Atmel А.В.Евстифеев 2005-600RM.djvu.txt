Часть 2. Микроконтроллеры семейства Mega 
Состояние с кодом $F8 является промежуточным. Наличие этого кода 
означает отсутствие какой-либо информации в связи с тем, что флаг 
TWINT не установлен. 
Код статуса $00 сигнализирует об ошибке на шине. Такая ошибка  
возникает при формировании ведущим состояний СТАРТ или СТОП в  
неположенном месте, например, во время передачи байта адреса, байта данных или 
бита подтверждения. Для выхода из таких ситуаций необходимо записать 
лог. 1 в разряды TWSTO и TWINT. В результате модуль перейдет в режим 
неадресованного ведущего, освободит линии SDA и SCL и сбросит флаг 
TWSTO. Состояние СТОП в этой ситуации сформировано не будет. 
Таблица 2.144. Коды статуса общего назначения 
Код 
 
статуса 
$F8 
$00 
Состояние шины 
и модуля TWI 
Нет информации; 
TWINT = «0» 
Ошибка на шине в  
результате некорректного  
формирования состояния 
СТАРТ или СТОП 
Действия программы 
в/из 
TWDR 
 
Нетдействий 
Нет  
действий 
в регистр TWCR 
STA 
STO 
TWINT 
TWEA 
Нет действий 
0 
1 
1 
X 
Следующее  
действие, выполняемое 
модулем TWI 
Ждать установки 
флага TWINT 
Все действия 
выполняются 
аппаратно. Шина 
освобождается, 
а флаг TWSTO 
сбрасывается в «0» 
18.5. Режимы работы модуля TWI 
Модуль TWI, реализованный в микроконтроллерах семейства Mega, 
может работать в следующих режимах: 
• ведущий передатчик (Master Transmitter); 
• ведущий приемник (Master Receiver); 
• ведомый передатчик (Slave Transmitter); 
• ведомый приемник (Slave Receiver). 
Выбор конкретного режима определяется логикой работы программы и, 
соответственно, выполняемыми действиями. 
18.5.1. Режим «Ведущий передатчик» 
В режиме «Ведущий передатчик» (Master Transmitter) осуществляется 
передача данных от ведущего устройства к ведомому. Для переключения 
устройства в режим ведущего модуль TWI должен сформировать на шине 
состояние СТАРТ. Формат адресного пакета, передаваемого затем,  
определяет в каком из режимов будет работать ведущий. При передаче пакета 
-370- 
