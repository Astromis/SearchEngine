Глава ^.Последовательный двухпроводный интерфейс 
- Разрешить работу модуля TWI 
- Разрешить подтверждение 
После инициализации регистров TWAR и TWCR модуль будет ожвдать 
адресного пакета с адресом, указанным в регистре TWAR, или общего  
вызова (если его распознавание разрешено). Значение следующего за адресом 
бита направления определит режим, в который переключится модуль. Если 
этот бит будет установлен в «1» (чтение), модуль TWI переключится в режим 
«Ведомый передатчик». В противном случае модуль переключится в режим 
«Ведомый приемник». Следует помнить, что устройство также может  
автоматически переключиться в режим «Ведомый приемник» из режима  
ведущего при потере приоритета (см. описание кода статуса $В0 в Табл. 2.148). 
После приема пакета SLA+R установится флаг TWINT, и состояние  
обмена можно будет, как обычно, определить по коду статуса. Возможные  
действия со стороны программы, соответствующие тому или иному коду  
статуса, указаны в Табл. 2.148. 
Таблица 2.148. Коды статуса для режима «Ведомый-передатчик» 
Состояние шины и 
модуля TWI 
Действия программы 
в/из 
TWDR 
в регистр 
TWCR 
Следующее действие, 
выполняемое модулем TWI 
$А8 
Был принят SLA+W 
с собственным  
адресом и послано  
подтверждение (АСК) 
Загрузить 
данные 
Будет передан последний байт данных; должно 
быть получено неподтверждение (NACK) 
Загрузить 
данные 
Будет передан очередной байт данных; должно 
быть получено подтверждение (АСК) 
Потеря приоритета в 
режиме ведущего во 
время передачи 
SLA+R/W; 
был принят SLA+W 
с собственным  
адресом и послано  
подтверждение (АСК) 
Загрузить 
данные 
Будет передан последний байт данных; должно 
быть получено неподтверждение (NACK) 
Загрузить 
данные 
Будет передан очередной байт данных; должно 
быть получено подтверждение (АСК) 
$В8 
Был передан байт 
данных и получено 
подтверждение 
(АСК) 
Загрузить 
данные 
Будет передан последний байт данных; должно 
быть получено неподтверждение (NACK) 
Загрузить 
данные 
Будет передан очередной байт данных; должно 
быть получено подтверждение (АСК) 
-383- 
