Глава ^.Последовательный двухпроводный интерфейс 
4. По окончании передачи адресного пакета устанавливается флаг 
TWINT. Код статуса, находящийся в регистре TWCR, индицирует 
об успешной передаче пакета, а также о получении 
подтверждения от ведомого устройства. 
5. Необходимо удостовериться в успешной передаче пакета и 
получении подтверждения, проверив содержимое регистра 
TWSR. Если код статуса соответствует ожидаемому, следует 
загрузить данные в регистр TWDR, а затем сформировать 
в регистре TWCR команду на передачу пакета (не забывая 
сбросить при этом флаг TWINT). Передача пакета данных 
начнется сразу же после сброса флага. 
6. По окончании передачи пакета данных устанавливается флаг 
TWINT. Код статуса, находящийся в регистре TWCR, индицирует 
об успешной передаче пакета, а также о получении 
подтверждения от ведомого устройства. 
7. Необходимо удостовериться в успешной передаче пакета и 
получении подтверждения, проверив содержимое регистра 
TWSR. Если код статуса соответствует ожидаемому, следует 
записать в регистр TWCR значение (не забывая сбросить 
при этом флаг TWINT), в соответствии с которым модуль 
TWI сформирует на шине состояние СТОП. Формирование 
состояния СТОП начнется сразу же после сброса флага TWINT 
Из сказанного видно, что любой этап взаимодействия прикладной  
программы с модулем TWI состоит из трех частей: 
• после завершения модулем выполнения какой-либо операции, он 
устанавливает флаг TWINT регистра TWCR и ожидает реакции 
программы. Пока флаг установлен в «1», на линии SCL  
удерживается НИЗКИЙ уровень; 
• после установки флага TWINT пользователь должен занести в  
регистры модуля значения, соответствующие следующему этапу  
обмена; 
• после обновления содержимого регистров модуля, пользователь 
должен сформировать в регистре TWCR команду на выполнение 
следующего этапа обмена. При загрузке в регистр нового 
значения необходимо сбросить флаг TWINT записью в него лог. 1. 
После сброса флага модуль начнет выполнение операции, 
определяемой содержимым регистра TWCR. 
Возможные значения кодов статуса, о которых упоминается в примере, 
будут приведены далее при описании конкретных режимов работы модуля 
TWI. Кроме того, имеется два кода состояния ($F8 и $00), не связанные с 
каким-либо режимом работы (Табл. 2.144). 
-369- 
