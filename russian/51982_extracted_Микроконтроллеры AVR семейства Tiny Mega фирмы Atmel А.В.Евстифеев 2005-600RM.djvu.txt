Глава ^.Последовательный двухпроводный интерфейс 
Формирование состояния СТАРТ начинается после записи в регистр 
TWCR следующего значения: 
- Разрешить работу модуля TWI 
- Сформировать состояние СТАРТ 
- Сбросить флаг TWINT 
В результате записи указанного значения модуль TWI начнет  
контролировать состояние шины и сформирует состояние СТАРТ сразу же, как 
только она станет свободной. 
По окончании формирования состояния СТАРТ устанавливается флаг 
TWINT; код статуса должен при этом иметь значение, равное 
$08 (Табл. 2.146). Для переключения модуля в режим «Ведущий 
передатчик» необходимо передать по шине пакет SLA+R. Для этого 
содержимое пакета загружается в регистр TWDR, а в регистр TWCR 
заносится следующее значение: 
т Разрешить работу модуля TWI 
Сбросить флаг TWINT 
После передачи адресного пакета и приема бита подтверждения флаг 
TWINT снова устанавливается в «1». Полученный от ведомого байт данных 
находится при этом в регистре TWDR. Код статуса на этом этапе может 
иметь одно из следующих значений: $38, $40 или $48. Какие действия  
необходимо предпринять при обнаружении того или иного кода подробно  
рассмотрено в Табл. 2.146. 
Описанная процедура используется для передачи всех пакетов данных. 
После приема последнего байта данных ведущий должен  
проинформировать об этом ведомого передатчика, послав сигнал неподтверждения 
(NACK). Затем ведущий должен сформировать на шине состояние СТОП 
или ПОВСТАРТ Формирование состояния СТОП начнется после записи 
в регистр TWCR следующего значения: 
Разрешить работу модуля TWI 
Сформировать состояние СТОП 
Сбросить флаг TWINT 
-375- 
