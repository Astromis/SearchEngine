Глава 9. Архитектура микроконтроллеров 
С помощью разрядов ХММ2...ХММ0 можно также обеспечить полное 
использование емкости микросхем внешнего ОЗУ. По умолчанию, как  
показано на Рис. 2.23, младшие адреса внешней памяти отображаются на  
адресное пространство внутреннего ОЗУ и часть емкости внешнего ОЗУ  
остается незадействованным. Полностью использовать емкость внешнего 
ОЗУ можно, программно управляя старшими разрядами адреса. Для  
выполнения этого «трюка» порт С должен быть настроен на вывод, а в  
защелке порта должно быть записано «$00». При маскировании старших 
разрядов адреса на соответствующие выводы порта С будут выставлены 
«0» и произойдет обращение к младшим адресам внешнего ОЗУ начиная с 
адреса $0000. Ниже приведены два примера программной реализации 
описанных действий для микроконтроллера ATmegal28. 
Пример на ассемблере 
;Константа OFFSET определена как $2000 для гарантированного 
/обращения к внешней памяти 
ldi rl6,$FF 
out DDRC,rl6 /Все выводы порта С выходы 
ldi rl6,$00 
out PORTC,rl6 /Записали в защелку порта $00 
ldi rl6, A«ХММ1) | A«ХММ0) 
out XMCRB,rl6 /Высвободили разряды РС7...РС5 
ldi rl6,$AA 
sts $0001+OFFSET,rl6 /Записали $АА по адресу $0001 
/внешней памяти 
ldi rl6, @«ХММ1) | @«ХММ0) 
out XMCRB, г1б /Переназначили разряды РС7...РС5 
ldi rl6,0 X 55 
sts 0x0001 + OFFSET,rl6 /Записали $55 по адресу (OFFSET + 1) 
/внешней памяти 
Пример на С 
#define OFFSET 0 х 2000 
void XRAM_example(void) 
{ 
unsigned char *p = (unsigned char *) (OFFSET + 1); 
DDRC = 0 X FF; 
PORTC = 0 X 00/ 
XMCRB = A«XMM1) | (l«XMM0); 
*p = Oxaa/ 
XMCRB = 0 X 00; 
*p = 0 X 55; 
} 
-183- 
