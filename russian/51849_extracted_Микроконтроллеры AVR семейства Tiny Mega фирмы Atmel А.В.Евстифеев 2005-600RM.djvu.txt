Часть 2. Микроконтроллеры семейства Mega 
Прерывания второго типа не имеют флагов прерываний и генерируются 
в течение всего времени, пока присутствуют условия, необходимые для  
генерации прерывания. Соответственно, если условия, вызывающие  
прерывание, исчезнут до разрешения прерывания, генерации прерывания не  
произойдет. 
Следует помнить, что при вызове подпрограмм обработки прерываний 
регистр состояния SREG не сохраняется. Поэтому пользователь должен  
самостоятельно запоминать содержимое этого регистра при входе в  
подпрограмму обработки прерывания (если это необходимо) и восстанавливать его 
значение перед вызовом команды RETI. 
Микроконтроллеры семейства Mega поддерживают очередь  
прерываний, которая работает следующим образом: если условия генерации 
одного или более прерываний возникают в то время, когда флаг общего 
разрешения прерываний сброшен (все прерывания запрещены),  
соответствующие флаги устанавливаются в «1» и остаются в этом состоянии 
до установки флага общего разрешения прерываний. После  
разрешения прерываний выполняется их обработка в порядке приоритета. 
Наименьшее время отклика для любого прерывания составляет 
4 машинных цикла, в течение которых происходит сохранение счетчика  
команд в стеке. В течение последующих двух (для моделей ATmega8x и 
ATmega8515x) или трех циклов выполняется команда перехода к  
подпрограмме обработки прерывания. Если прерывание произойдет во время  
выполнения команды, длящейся несколько циклов, то генерация прерывания 
произойдет только после выполнения этой команды. Если же прерывание 
произойдет во время нахождения микроконтроллера в «спящем» режиме, 
время отклика увеличивается еще на 4 машинных цикла. 
Возврат в основную программу занимает 4 машинных цикла, в течение 
которых происходит восстановление счетчика команд из стека. После  
выхода из прерывания процессор всегда выполняет одну команду основной  
программы, прежде чем обслужить любое отложенное прерывание. 
11.4. Внешние прерывания 
Для разрешения/запрещения внешних прерываний во всех моделях, 
кроме ATmega64x и ATmegal28x, предназначен регистр GICR (GIMSK в 
моделях ATmegal61x и ATmegal63x), расположенный по адресу $ЗВ ($5В). 
Формат этого регистра для различных моделей показан на Рис. 2.54, а  
описание его разрядов, относящихся к прерываниям, приведено в Табл. 2.63. 
-240- 
