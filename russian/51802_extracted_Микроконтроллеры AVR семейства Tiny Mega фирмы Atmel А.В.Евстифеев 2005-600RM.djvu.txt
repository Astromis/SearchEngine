Часть 2. Микроконтроллеры семейства Mega 
Пример на С 
void EEPROM_write(unsigned int uiAddress, unsigned char ucData) 
{ 
while (EECR & A«EEWE)); /*Ждать завершения предыдущей записи*/ 
EEAR = uiAddress; /*Проинициализировать регистры*/ 
EEDR = ucData/ 
EECR |= A«EEMWE); /^Установить флаг EEMWE*/ 
EECR |= A«EEWE); /*Начать запись в EEPROM*/ 
} 
Перед выполнением операции чтения также необходимо  
проконтролировать состояние флага EEWE. Дело в том, что пока выполняется  
операция записи в EEPROM-память (флаг EEWE установлен), нельзя  
выполнять ни чтения EEPROM-памяти, ни изменения регистра адреса. 
После загрузки требуемого адреса в регистр EEAR необходимо  
установить в «1» разряд EERE регистра EECR. Когда запрошенные данные 
будут помещены в регистр данных EEDR, произойдет аппаратный сброс 
этого разряда. Однако следить за состоянием разряда EERE для  
определения момента завершения операции чтения не требуется, т. к. операция 
чтения из EEPROM всегда выполняется за один машинный цикл. Кроме 
того, после установки разряда EERE в «1» процессор пропускает 4  
машинных цикла перед началом выполнения следующей инструкции. 
С учетом сказанного функция чтения из EEPROM может быть  
реализована следующим образом: 
Пример на ассемблере 
EEPROM_read: 
sbic EECR,EEWE ;Ждать завершения предыдущей записи 
rjmp EEPROM_read 
out EEARH, rl8 
out EEARL, rl7 /Занести адрес (rl8:rl7) в регистр адреса 
sbi EECR,EERE /Начать чтение 
in г16, EEDR /Сохранить данные 
ret 
Пример на С 
unsigned char EEPROM_write(unsigned int uiAddress) 
{ 
while (EECR & A«EEWE)); /*Ждать завершения предыдущей записи*/ 
EEAR = uiAddress/ /*Проинициализировать регистр адреса*/ 
EECR |= A«EERE); /*Выполнить чтение*/ 
return EEDR/ 
} 
—192 — 
