Часть 4. Программирование микроконтроллеров семейств Tiny и Mega 
SPMCR и в течение четырех машинных циклов, выполнить команду 
SPM. Очистка буфера осуществляется автоматически по окончании 
записи страницы либо вручную, записью лог. 1 в разряд RWWSRE  
регистра SPMCR. Заметим, что запись по одному и тому же адресу в  
буфере невозможна без его очистки. 
Запись содержимого буфера в память программ осуществляется 
аналогично. В регистр Z (секция PCPAGE) заносится адрес страницы, 
в регистр SPMCR записывается значение «xOOOOlOl» и в течение 
четырех машинных циклов выполняется команда SPM. Содержимое 
регистров R1 и R0 при этом игнорируется. 
26.3.3. Изменение ячеек защиты загрузчика 
Изменение ячеек защиты загрузчика BLB12:BLB11 и BLB02:BLB01 
также осуществляется командой SPM. Для этого необходимо загрузить 
в регистр R0 требуемое значение в соответствии с Рис. 4.20  
(сброшенный разряд означает программирование соответствующей ячейки). 
R0 
BLB12 BLB11 BLB02 BLB01 
Рис. 4.20. Изменение состояния ячеек защиты 
регистра RO по команде SPM 
После этого необходимо записать значение «х0001001» в регистр 
SPMCR и в течение четырех машинных циклов выполнить команду 
SPM. Содержимое регистра Z при этом игнорируется, однако для  
совместимости с будущими устройствами рекомендуется записывать в 
него значение $0001. Во время программирования ячеек защиты  
можно обращаться к любой области памяти программ. 
26.3.4. Чтение конфигурационных ячеек и ячеек защиты 
Помимо программирования микроконтроллера, загрузчик может 
также считывать содержимое конфигурационных ячеек и ячеек  
защиты. Так, для чтения байта защиты следует загрузить в регистр Z число 
$0001, записать в регистр SPMCR значение «хООО 1001» и в течение трех 
машинных циклов выполнить команду LPM. В результате содержимое 
байта защиты будет занесено в заданный регистр общего назначения. 
Соответствие разрядов регистра ячейкам приведено на Рис. 4.1. 
Чтение конфигурационных байтов осуществляется аналогично. 
В регистр Z загружается адрес байта ($0000 — младший байт, $0003 — 
старший байт, $0002 — дополнительный байт), после чего необходимо 
-536- 
