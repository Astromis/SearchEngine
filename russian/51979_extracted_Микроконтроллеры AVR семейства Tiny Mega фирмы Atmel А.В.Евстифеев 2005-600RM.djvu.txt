Часть 2. Микроконтроллеры семейства Mega 
- Разрешить работу модуля TWI 
- Сформировать состояние СТОП 
- Сбросить флаг TWINT 
А для формирования состояния ПОВСТАРТ в регистр TWCR  
необходимо занести следующее значение: 
Разрешить работу модуля TWI 
Сформировать состояние СТАРТ 
Сбросить флаг TWINT 
После формирования на шине состояния ПОВСТАРТ (код статуса $10) 
ведущий может адресовать того же или другого ведомого не формируя 
состояния СТОП. Другими словами, использование состояния ПОВСТАРТ 
позволяет осуществлять смену ведомых устройств, а также переключаться 
между режимами «Ведущий передатчик» и «Ведущий приемник» без утери 
контроля над шиной. 
Таблица 2.145. Коды статуса для режима «Ведущий передатчик» 
Состояние шины 
и модуля TWI 
Действия программы 
B/H3TWDR 
в регистр TWCR 
Следующее действие, 
выполняемое модулем TWI 
$08 
Было сформировано 
состояние СТАРТ 
Загрузить 
SLA + W 
Будет передан SLA + W. 
Будет получен АСК или NACK 
$10 
Было сформировано 
состояние 
ПОВСТАРТ 
Загрузить 
SLA + W 
Будет передан SLA + W. 
Будет получен АСК или NACK 
Загрузить 
SLA + R 
Будет передан SLA + R. 
Модуль переключится в режим  
«Ведущий приемник» 
Загрузить 
данные 
Будет передан байт данных. 
Будет получен АСК или NACK 
$18 
Был передан пакет 
SLA+W и принято 
подтверждение 
(АСК) 
Нет действий 
Будет сформировано состояние 
ПОВСТАРТ 
Нет действий 
Будет сформировано состояние 
СТОП (флаг TWSTO будет  
сброшен) 
Нет действий 
Будет сформировано состояние 
СТОП, а затем состояние СТАРТ 
(флаг TWSTO будет сброшен) 
-372- 
