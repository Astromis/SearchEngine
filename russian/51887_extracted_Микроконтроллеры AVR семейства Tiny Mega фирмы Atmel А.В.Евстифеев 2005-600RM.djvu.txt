Часть 2. Микроконтроллеры семейства Mega 
Продолжение таблицы 2.87 
Разряд 
1 
0 
Название 
OCR/iUB 
TCRwUB 
Описание 
Состояние обновления регистра OCRn При записи в регистр OCR/? 
этот флаг устанавливается в «1», а после пересылки записываемого  
значения в этот регистр флаг аппаратно сбрасывается в «0» Таким образом, 
сброшенный флаг OCRa/UB означает, что регистр OCR/? готов для записи 
в него нового значения Запись в регистр OCR/z при установленном флаге 
OCR/ШВ может привести к повреждению прежнего содержимого  
регистра и к генерации прерывания 
Состояние обновления регистра TCCRw При записи в регистр TCCR/i 
этот флаг устанавливается в «1», а после пересылки записываемого  
значения в этот регистр флаг аппаратно сбрасывается в «0» Таким образом, 
сброшенный флаг TCR/iUB означает, что регистр TCCRa? готов для  
записи в него нового значения Запись в регистр TCCR/i при установленном 
флаге TCR/ШВ может привести к повреждению прежнего содержимого 
регистра и к генерации прерывания 
Примечание: п = 0 для моделей ATmega64x/128x и п = 2 для остальных моделей 
(кроме ATmega8515x) 
Необходимо отметить, что при переключении между синхронным и 
асинхронным режимами, содержимое регистров таймера/счетчика может 
быть повреждено. Чтобы этого избежать, рекомендуется действовать в  
следующей последовательности: 
• запретить прерывания от таймера/счетчика; 
• переключить его в требуемый режим; 
• записать новые значения в регистры TCNT2, OCR2 и TCCR2; 
• в случае переключения в асинхронный режим ждать, пока флаги 
TCNOUB (TCN2UB), OCR0UB (OCR0UB) и TCROUB (TCR0UB) 
не будут сброшены; 
• сбросить флаги прерываний таймера/счетчика; 
• разрешить прерывания (если требуется). 
При работе таймера/счетчика в асинхронном режиме установка флагов 
прерываний от него производится синхронно с тактовым сигналом  
микроконтроллера. Для синхронизации требуется 3 машинных цикла плюс один 
период тактового сигнала таймера/счетчика. Поэтому к моменту, когда 
микроконтроллер сможет прочитать состояние счетчика, вызвавшее  
установку флага прерывания, оно изменится по меньшей мере на единицу. 
Изменение состояния вывода ОСО (ОС2) производится по тактовому  
сигналу таймера/счетчика и не синхронизируется с тактовым сигналом  
микроконтроллера. 
Отдельно следует сказать о «взаимодействии» асинхронного 
режима таймеров/счетчиков с режимами пониженного  
энергопотребления микроконтроллера Power Down, Power Save, Standby и 
Extended Standby. 
Первое замечание касается использования прерываний оттаймера/счет- 
-278- 
