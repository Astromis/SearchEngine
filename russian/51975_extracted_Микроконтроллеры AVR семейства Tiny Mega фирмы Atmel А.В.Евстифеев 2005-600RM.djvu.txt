Часть 2. Микроконтроллеры семейства Mega 
В старших пяти разрядах (TWS7:0) регистра TWSR при этом формируется 
некоторое значение, характеризующее текущее состояние шины TWI.  
Соответственно, программа должна проанализировать это значение и задать 
дальнейшее поведение модуля TWI, манипулируя содержимым регистров 
TWCRhTWDR. 
На Рис. 2.122 показано взаимодействие прикладной программы 
с модулем TWI на простейшем примере передачи одного байта данных 
от ведущего к ведомому. 
Рис. 2.122. Пример взаимодействия программы с модулемТ\?1 
Передача данных происходит в следующей последовательности: 
1. Первой операцией при передаче данных по шине TWI является 
формирование состояния СТАРТ. Для этого следует записать 
определенное значение в регистр TWCR, в соответствии с 
которым модуль TWI сформирует на шине состояние СТАРТ. 
При этом разряд записываемого значения, соответствующий 
флагу TWINT, должен быть установлен в «1» для сброса этого 
флага. Формирование состояния СТАРТ начнется сразу же после 
сброса флага TWINT 
2. После формирования состояния СТАРТ устанавливается флаг 
TWINT Число, находящееся в регистре состояния TWSR, 
индицирует результат выполнения этой операции. 
3. Необходимо удостовериться в успешном формировании 
состояния СТАРТ, проверив содержимое регистра TWSR. Если 
код статуса соответствует ожидаемому, следует загрузить 
в регистр TWDR содержимое пакета SLA+W и сформировать 
в регистре TWCR команду на передачу пакета (не забывая 
сбросить при этом флаг TWINT). Передача адресного пакета 
начнется сразу же после сброса флага. 
-368- 
