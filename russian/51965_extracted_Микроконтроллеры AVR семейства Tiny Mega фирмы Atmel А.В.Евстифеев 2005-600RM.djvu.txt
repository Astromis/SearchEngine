Часть 2. Микроконтроллеры семейства Mega 
Рис. 2.113. Синхронизация сигнала SCL нескольких ведущих 
Для решения описанной задачи все ведущие устройства после выдачи 
данных на линию SDA контролируют ее состояние. Если состояние линии 
отличается от того, в которое ее переводил ведущий, он теряет приоритет 
(Рис. 2.114). Еще раз напомним, что такое возможно только в случае вьща- 
чи им сигнала ВЫСОКОГО уровня во время выдачи другими ведущими 
(получившими приоритет) сигнала НИЗКОГО уровня. Ведущий,  
потерявший приоритет, должен немедленно переключиться в режим ведомого и 
проверить, не был ли он адресован каким-либо из ведущих, получивших 
приоритет. При этом он должен продолжать удерживать на линии SDA  
сигнал ВЫСОКОГО уровня. Однако он может продолжать генерировать  
тактовый сигнал до окончания передачи текущего пакета. 
Процесс распределения приоритетов продолжается до тех пор, пока на 
шине не останется только один ведущий. В случае если несколько ведущих 
пытаются адресовать одного и того же ведомого, процесс распределения 
приоритетов продолжается и во время передачи пакета данных. Отсюда  
следует, в частности, что все циклы обмена должны содержать одинаковое  
количество пакетов данных, в противном случае результат процесса  
распределения приоритетов будет неопределенным. 
При этом следует помнить, что процесс распределения приоритетов не 
должен выполняться между: 
• состоянием ПОВСТАРТ и передачей разряда данных; 
• состоянием СТОП и передачей разряда данных; 
• состоянием ПОВСТАРТ и СТОП. 
Ответственность за невозникновение перечисленных ситуаций ложится 
на программное обеспечение устройств, подключенных к шине. 
-358- 
