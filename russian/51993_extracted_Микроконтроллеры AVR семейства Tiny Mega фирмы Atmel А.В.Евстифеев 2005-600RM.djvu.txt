Часть 2. Микроконтроллеры семейства Mega 
Из сказанного видно, что при выполнении операции происходит 
передача информации как от ведущего к ведомому, так и наоборот. После 
инициирования обмена по шине ведущий должен находиться в режиме  
«Ведущий передатчик», чтобы сообщить ведомому адрес, по которому он  
намеревается осуществить чтение. Для выполнения следующего этапа операции 
(чтение данных) ведущий должен переключиться в режим «Ведущий  
приемник». При этом он должен сохранять контроль над шиной во время  
выполнения всех этапов операции. Для этого используется состояние 
ПОВСТАРТ. В рассматриваемом случае ведущий формирует это состояние 
между передачей адреса и приемом данных, как показано на Рис. 2.127. 
Рис. 2.127. Пример обращения к внешнему EEPROM 
18.5.6. Арбитраж 
В случае присутствия на шине нескольких ведущих возможна ситуация, 
при которой несколько ведущих одновременно начнут процесс обмена. Для 
таких случаев спецификацией TWI предусмотрен процесс распределения 
приоритетов (арбитраж), в результате выполнения которого на шине  
остается только одно ведущее устройство. Принципы этого процесса были  
рассмотрены в параграфе 2.2, однако его выполнение может развиваться по 
различным сценариям (Рис. 2.128): 
1. Два или более ведущих осуществляют однотипный обмен с 
одним и тем же ведомым. В этом случае никто из них не сможет 
распознать конфликт на шине. 
2. Два или более ведущих обращаются к одному и тому же ведомому 
с различными данными или различными типами обмена 
(чтение/запись). В этом случае распределение приоритетов 
произойдет во время передачи битов данных или бита 
направления. Ведущий, потерявший приоритет, может либо 
переключиться в режим неадресованного ведомого, либо 
дождаться освобождения шины и сформировать состояние 
СТАРТ для ее захвата. 
3. Два или более ведущих обращаются к различным ведомым. В 
этом случае распределение приоритетов начнется во время 
передачи битов адресного пакета. Ведущий, потерявший 
приоритет, переключится в режим ведомого для проверки, не 
-386- 
